---
title: "Exploring SANBS data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
```

## Reading data, checking format


First read in just 10 rows and look to make sure the type is correct with str()

```{r}
t_donations <- fread("../1_data/private/SANBS Donations (3 Nov 2022).csv", nrows = 10)
str(t_donations)
```

Observations:

* visit_date in date format already which is god
* Ferritin 0 instead of NA when not measured, can cause problems if not addressed

Then I read in the rest of the data
```{r}
t_donations <- fread("../1_data/private/SANBS Donations (3 Nov 2022).csv")
#t_donations <- fread("../1_data/private/SANBS Donations (3 Nov 2022).csv", skip = 4371067)
```

First, got this warning

> Warning in fread("../1_data/local/SANBS_Donations_2022_11_03.csv") :
  Stopped early on line 144. Expected 25 fields but found 26. Consider fill=TRUE and comment.char=. First discarded non-empty line: <<18406,2021-07-06 00:00:00.000,2021,7,1525,66.1,M,Mobile Clinic,EWE025,DEF PROD,DEFERRAL,DEFERRAL,ONEG,NEG,12.30,1,White,0.0,Haematocrit/Haemoglobin,Hb004 - Hb Fail (M,Fpm) < 12.5,2021-07-06 00:00:00.000,2022-01-02 00:00:00.000,Temp,2021,7>>

Opened file in excel. The problem appears to be that th name of the deferral code "Hb004 - Hb Fail (M, Fmp) < 12,.5)" has a comma in it which is our break between cells. Scrolling further down I find a deferral code "PI003 - Pilot, diver, mountaineer" which has 2 commas in it so it breaks it into three cells. Used find and replace to get rid of all the commas in the DefCode column.

Read the full dataset again and got this warning: 

> Warning in fread("../1_data/private/SANBS Donations (3 Nov 2022).csv") :
  Stopped early on line 4371069. Expected 25 fields but found 0. Consider fill=TRUE and comment.char=. First discarded non-empty line: <<(4371067 rows affected)>>
  
I used the "skip" argument to look at what comes after row 4371067, and it looks like it is just a timestamp of when the data were pulled:

> t_donations
           V1    V2                  V3
1: Completion time: 2022-11-04 14:38:36

Based on this, it seems OK to just ignore the warning message.


## Exploratory analysis

Next it would be good to look at things like:

* Number of donations per month/year
* Distribution of each column and rate of missingness (dfSummary is good for this)
* Number of donations with ferritin

etc.
